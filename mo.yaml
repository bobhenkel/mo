tasks:
  venv:
    description: Create an approriate Python virtual environment.
    command: |
      ([ ! -f venv/bin/python ] && {{ pyvenv }} venv) || exit 0
      venv/bin/pip install --quiet -r requirements.txt
      venv/bin/pip install --quiet -e .

  requirements:
    description: Save the installed packages into a requirements.txt file.
    command: venv/bin/pip freeze > requirements.txt
    after:
      - venv

  readme:
    description: Convert the Markdown README file into a reST one.
    command: pandoc README.md -o README.rst

  test:
    command: |
      venv/bin/coverage run --source=mo setup.py test
      venv/bin/coverage html
    after:
      - venv

  docs:
    command: |
      venv/bin/python setup.py build_sphinx
    after:
      - venv

variables:
  pyvenv:
    description: Location of 'pyvenv' command.
    default: pyvenv
